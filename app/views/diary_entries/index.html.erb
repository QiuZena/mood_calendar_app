<h1>All Diary Entries</h1>


<h2>This Month's Mood Calendar</h2>

<div class="calendar-scroll">
  <div class="calendar-wrapper">
    <h3><%= month_calendar(attribute: :entry_date, events: @current_month_entries, class: "calendar") do |date, entries| %></h3>
      <div class="calendar-cell">
        <div class="date-number"><%= date.day %></div>

        <div class="mood-entries">
          <% entries.each do |entry| %>
            <% if entry.mood.present? && entry.mood.icon.present? %>
              <%= link_to image_tag(asset_path(entry.mood.icon), class: "calendar-mood-img"), diary_entry_path(entry) %>
            <% else %>
              <%= link_to "View", diary_entry_path(entry) %>
            <% end %>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>




<h2>How do you feel today?</h2>
<div class="mood-cards">
  <% @moods.each do |mood| %>
    <% if current_user %>
      <%= link_to new_diary_entry_path(mood_id: mood.id), class: "mood-card" do %>
        <%= image_tag asset_path(mood.icon), size: "40x40", alt: mood.name %>
        <span><%= mood.name %></span>
      <% end %>
    <% else %>
      <div class="mood-card" onclick="alert('Please log in or sign up to post your mood.')">
        <%= image_tag asset_path(mood.icon), size: "40x40", alt: mood.name %>
        <span><%= mood.name %></span>
      </div>
    <% end %>
  <% end %>

</div>

<h2>Today's Mood from Others</h2>

<div class="others-mood">
  <% @todays_entries.each do |entry| %>
    <div class="user-mood">
      <strong><%= entry.user.username %></strong>:
      <%= image_tag entry.mood.icon, size: "20x20" if entry.mood.icon.present? %>

      <% if entry.content.present? %>
        <%= entry.content %>
      <% end %>

      <% if entry.image.attached? %>
        <div class="entry-image">
          <%= image_tag entry.image.variant(resize_to_limit: [200, 200]) %>
        </div>
      <% end %>
    </div>
    <% if current_user && entry.likes.exists?(user_id: current_user.id) %>
      <%= button_to "❤️ Unlike (#{entry.likes.count})", diary_entry_like_path(entry, entry.likes.find_by(user_id: current_user.id)), method: :delete %>
    <% else %>
      <%= button_to "🤍 Like (#{entry.likes.count})", diary_entry_likes_path(entry), method: :post %>
    <% end %>
    <% if entry.comments.any? %>
      <div class="comments">
        <h4>Comments:</h4>
        <ul>
          <% entry.comments.each do |comment| %>
            <li><strong><%= comment.user.username %>:</strong> <%= comment.content %></li>
          <% end %>
        </ul>
      </div>
    <% end %>



    <% if current_user %>
      <%= form_with url: diary_entry_comments_path(entry), method: :post, local: true do |f| %>
        <%= f.text_field :content, placeholder: "Leave a comment..." %>
        <%= f.submit "Comment" %>
      <% end %>
    <% end %>
    </div>


  <% end %>
</div>



